"use strict";(()=>{var Jn=Object.create;var yr=Object.defineProperty;var Qn=Object.getOwnPropertyDescriptor;var ti=Object.getOwnPropertyNames;var ei=Object.getPrototypeOf,ri=Object.prototype.hasOwnProperty;var W=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ni=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of ti(t))!ri.call(e,i)&&i!==r&&yr(e,i,{get:()=>t[i],enumerable:!(n=Qn(t,i))||n.enumerable});return e};var vr=(e,t,r)=>(r=e!=null?Jn(ei(e)):{},ni(t||!e||!e.__esModule?yr(r,"default",{value:e,enumerable:!0}):r,e));var re=W(m=>{"use strict";var D=m&&m.__assign||function(){return D=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},D.apply(this,arguments)},ui=m&&m.__generator||function(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(a){return function(f){return l([a,f])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=a[0]&2?i.return:a[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,a[1])).done)return s;switch(i=0,s&&(a=[a[0]&2,s.value]),a[0]){case 0:case 1:s=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!s||a[1]>s[0]&&a[1]<s[3])){r.label=a[1];break}if(a[0]===6&&r.label<s[1]){r.label=s[1],s=a;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(a);break}s[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(f){a=[6,f],i=0}finally{n=s=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},R=m&&m.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,s;n<i;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))};m.__esModule=!0;m.diff=m.iterate=m.sift=m.replaceOrAppend=m.merge=m.fork=m.intersects=m.flat=m.list=m.range=m.unique=m.cluster=m.min=m.max=m.select=m.objectify=m.replace=m.counting=m.alphabetical=m.sort=m.last=m.first=m.sum=m.boil=m.group=void 0;var li=function(e,t){return e.reduce(function(r,n){var i,s,o=t(n),u=(s=r[o])!==null&&s!==void 0?s:[];return D(D({},r),(i={},i[o]=R(R([],u,!0),[n],!1),i))},{})};m.group=li;var ci=function(e,t){var r;return!e||((r=e.length)!==null&&r!==void 0?r:0)===0?null:e.reduce(t)};m.boil=ci;var fi=function(e,t){return(e||[]).reduce(function(r,n){return r+(t?t(n):n)},0)};m.sum=fi;var hi=function(e,t){return t===void 0&&(t=void 0),e?.length>0?e[0]:t};m.first=hi;var di=function(e,t){return t===void 0&&(t=void 0),e?.length>0?e[e.length-1]:t};m.last=di;var pi=function(e,t,r){if(r===void 0&&(r=!1),!e)return[];var n=function(s,o){return t(s)-t(o)},i=function(s,o){return t(o)-t(s)};return e.slice().sort(r===!0?i:n)};m.sort=pi;var mi=function(e,t,r){if(r===void 0&&(r="asc"),!e)return[];var n=function(s,o){return(""+t(s)).localeCompare(t(o))},i=function(s,o){return(""+t(o)).localeCompare(t(s))};return e.slice().sort(r==="desc"?i:n)};m.alphabetical=mi;var gi=function(e,t){return e.reduce(function(r,n){var i,s,o=t(n);return D(D({},r),(i={},i[o]=((s=r[o])!==null&&s!==void 0?s:0)+1,i))},{})};m.counting=gi;var _i=function(e,t,r){if(!e)return[];if(!t)return R([],e,!0);for(var n=0;n<e.length;n++){var i=e[n];if(r(i,n))return R(R(R([],e.slice(0,n),!0),[t],!1),e.slice(n+1,e.length),!0)}return R([],e,!0)};m.replace=_i;var yi=function(e,t,r){return r===void 0&&(r=function(n){return n}),e.reduce(function(n,i){var s;return D(D({},n),(s={},s[t(i)]=r(i),s))},{})};m.objectify=yi;var vi=function(e,t,r){return e.reduce(function(n,i){return r(i)?R(R([],n,!0),[t(i)],!1):n},[])};m.select=vi;var xi=function(e,t){var r=t||function(n){return n};return(0,m.boil)(e,function(n,i){return r(n)>r(i)?n:i})};m.max=xi;var Ei=function(e,t){var r=t||function(n){return n};return(0,m.boil)(e,function(n,i){return r(n)<r(i)?n:i})};m.min=Ei;var Ti=function(e,t){t===void 0&&(t=2);var r=Math.ceil(e.length/t);return new Array(r).fill(null).map(function(n,i){return e.slice(i*t,i*t+t)})};m.cluster=Ti;var bi=function(e,t){var r=e.reduce(function(n,i){var s,o=t?t(i):i;return n[o]?n:D(D({},n),(s={},s[o]=i,s))},{});return Object.values(r)};m.unique=bi;function Fr(e,t,r){var n;return r===void 0&&(r=1),ui(this,function(i){switch(i.label){case 0:n=e,i.label=1;case 1:return n<=t?[4,n]:[3,4];case 2:if(i.sent(),n+r>t)return[3,4];i.label=3;case 3:return n+=r,[3,1];case 4:return[2]}})}m.range=Fr;var wi=function(e,t,r){return r===void 0&&(r=1),Array.from(Fr(e,t,r))};m.list=wi;var Ci=function(e){return e.reduce(function(t,r){return R(R([],t,!0),r,!0)},[])};m.flat=Ci;var Si=function(e,t,r){if(!e||!t)return!1;var n=r??function(s){return s},i=t.reduce(function(s,o){var u;return D(D({},s),(u={},u[n(o)]=!0,u))},{});return e.some(function(s){return i[n(s)]})};m.intersects=Si;var Ri=function(e,t){return e?e.reduce(function(r,n){var i=r[0],s=r[1];return t(n)?[R(R([],i,!0),[n],!1),s]:[i,R(R([],s,!0),[n],!1)]},[[],[]]):[[],[]]};m.fork=Ri;var Pi=function(e,t,r){return!t&&!e?[]:t?e?r?e.reduce(function(n,i){var s=t.find(function(o){return r(i)===r(o)});return s?R(R([],n,!0),[s],!1):R(R([],n,!0),[i],!1)},[]):e:[]:e};m.merge=Pi;var Ii=function(e,t,r){if(!e&&!t)return[];if(!t)return R([],e,!0);if(!e)return[t];for(var n=0;n<e.length;n++){var i=e[n];if(r(i,n))return R(R(R([],e.slice(0,n),!0),[t],!1),e.slice(n+1,e.length),!0)}return R(R([],e,!0),[t],!1)};m.replaceOrAppend=Ii;var Fi=function(e){var t;return(t=e?.filter(function(r){return!!r}))!==null&&t!==void 0?t:[]};m.sift=Fi;var Oi=function(e,t,r){for(var n=r,i=1;i<=e;i++)n=t(n,i);return n};m.iterate=Oi;var Ai=function(e,t,r){if(r===void 0&&(r=function(i){return i}),!e?.length&&!t?.length)return[];if(!e?.length)return t;if(!t?.length)return e;var n=t.reduce(function(i,s){var o;return D(D({},i),(o={},o[r(s)]=!0,o))},{});return e.filter(function(i){return!n[r(i)]})};m.diff=Ai});var Ar=W(C=>{"use strict";var Mi=C&&C.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])},e(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),lt=C&&C.__awaiter||function(e,t,r,n){function i(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function u(f){try{a(n.next(f))}catch(p){o(p)}}function l(f){try{a(n.throw(f))}catch(p){o(p)}}function a(f){f.done?s(f.value):i(f.value).then(u,l)}a((n=n.apply(e,t||[])).next())})},ct=C&&C.__generator||function(e,t){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function u(a){return function(f){return l([a,f])}}function l(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(s=a[0]&2?i.return:a[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,a[1])).done)return s;switch(i=0,s&&(a=[a[0]&2,s.value]),a[0]){case 0:case 1:s=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!s||a[1]>s[0]&&a[1]<s[3])){r.label=a[1];break}if(a[0]===6&&r.label<s[1]){r.label=s[1],s=a;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(a);break}s[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(f){a=[6,f],i=0}finally{n=s=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};C.__esModule=!0;C.tryit=C.sleep=C.retry=C.parallel=C.AggregateError=C.defer=C.map=C.reduce=void 0;var ne=re(),Li=function(e,t,r){return lt(void 0,void 0,void 0,function(){var n,i,s,o,u,l;return ct(this,function(a){switch(a.label){case 0:if(n=r!==void 0,!n&&e?.length<1)throw new Error("Cannot reduce empty array with no init value");i=n?e:e.slice(1),s=n?r:e[0],o=0,u=i,a.label=1;case 1:return o<u.length?(l=u[o],[4,t(s,l)]):[3,4];case 2:s=a.sent(),a.label=3;case 3:return o++,[3,1];case 4:return[2,s]}})})};C.reduce=Li;var Ui=function(e,t){return lt(void 0,void 0,void 0,function(){var r,n,i,s,o;return ct(this,function(u){switch(u.label){case 0:r=[],n=0,i=e,u.label=1;case 1:return n<i.length?(s=i[n],[4,t(s)]):[3,4];case 2:o=u.sent(),r.push(o),u.label=3;case 3:return n++,[3,1];case 4:return[2,r]}})})};C.map=Ui;var Gi=function(e){return lt(void 0,void 0,void 0,function(){var t,r,n,i,s,o,u,l,a,f,p;return ct(this,function(d){switch(d.label){case 0:return t=[],r=function(v,x){var g;return t.push({fn:v,rethrow:(g=x?.rethrow)!==null&&g!==void 0?g:!1})},[4,(0,C.tryit)(e)(r)];case 1:n=d.sent(),i=n[0],s=n[1],o=0,u=t,d.label=2;case 2:return o<u.length?(l=u[o],a=l.fn,f=l.rethrow,[4,(0,C.tryit)(a)(i)]):[3,5];case 3:if(p=d.sent()[0],f)throw p;d.label=4;case 4:return o++,[3,2];case 5:if(i)throw i;return[2,s]}})})};C.defer=Gi;var Or=function(e){Mi(t,e);function t(r){var n=e.call(this)||this;return n.errors=r,n}return t}(Error);C.AggregateError=Or;var ji=function(e,t,r){return lt(void 0,void 0,void 0,function(){var n,i,s,o,u,l,a;return ct(this,function(f){switch(f.label){case 0:return n=t.map(function(p,d){return{index:d,item:p}}),i=function(p){return lt(void 0,void 0,void 0,function(){var d,v,x,g,w;return ct(this,function(S){switch(S.label){case 0:d=[],S.label=1;case 1:return v=n.pop(),v?[4,(0,C.tryit)(r)(v.item)]:[2,p(d)];case 2:return x=S.sent(),g=x[0],w=x[1],d.push({error:g,result:w,index:v.index}),[3,1];case 3:return[2]}})})},s=(0,ne.list)(1,e).map(function(){return new Promise(i)}),[4,Promise.all(s)];case 1:if(o=f.sent(),u=(0,ne.fork)((0,ne.sort)(o.flat(),function(p){return p.index}),function(p){return!!p.error}),l=u[0],a=u[1],l.length>0)throw new Or(l.map(function(p){return p.error}));return[2,a.map(function(p){return p.result})]}})})};C.parallel=ji;var Xi=function(e,t){return lt(void 0,void 0,void 0,function(){var r,n,i,s,o,u,l,a,f,p,d;return ct(this,function(v){switch(v.label){case 0:r=(p=e?.times)!==null&&p!==void 0?p:3,n=e?.delay,i=(d=e?.backoff)!==null&&d!==void 0?d:null,s=0,o=(0,ne.list)(1,r),v.label=1;case 1:return s<o.length?(u=o[s],[4,(0,C.tryit)(t)(function(x){throw{_exited:x}})]):[3,7];case 2:if(l=v.sent(),a=l[0],f=l[1],!a)return[2,f];if(a._exited)throw a._exited;if(u===r)throw a;return n?[4,(0,C.sleep)(n)]:[3,4];case 3:v.sent(),v.label=4;case 4:return i?[4,(0,C.sleep)(i(u))]:[3,6];case 5:v.sent(),v.label=6;case 6:return s++,[3,1];case 7:return[2]}})})};C.retry=Xi;var Di=function(e){return new Promise(function(t){return setTimeout(t,e)})};C.sleep=Di;var Ni=function(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return lt(void 0,void 0,void 0,function(){var n,i;return ct(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),n=[null],[4,e.apply(void 0,t)];case 1:return[2,n.concat([s.sent()])];case 2:return i=s.sent(),[2,[i,null]];case 3:return[2]}})})}};C.tryit=Ni});var Lr=W(F=>{"use strict";var ie=F&&F.__assign||function(){return ie=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},ie.apply(this,arguments)},Mr=F&&F.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,s;n<i;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))};F.__esModule=!0;F.throttle=F.debounce=F.memo=F.proxied=F.partob=F.partial=F.compose=F.chain=void 0;var ki=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return e.slice(1).reduce(function(i,s){return s(i)},e[0].apply(e,r))}};F.chain=ki;var qi=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.reverse().reduce(function(r,n){return n(r)})};F.compose=qi;var Yi=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return e.apply(void 0,Mr(Mr([],t,!1),n,!1))}};F.partial=Yi;var Wi=function(e,t){return function(r){return e(ie(ie({},t),r))}};F.partob=Wi;var zi=function(e){return new Proxy({},{get:function(t,r){return e(r)}})};F.proxied=zi;var Ki=function(e,t,r,n){return function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var u=r?r.apply(void 0,s):JSON.stringify({args:s}),l=e[u];if(l!==void 0&&l.exp>new Date().getTime())return l.value;var a=t.apply(void 0,s);return e[u]={exp:new Date().getTime()+n,value:a},a}},Bi=function(e,t){var r=t===void 0?{}:t,n=r.key,i=n===void 0?null:n,s=r.ttl,o=s===void 0?300:s;return Ki({},e,i,o)};F.memo=Bi;var Zi=function(e,t){var r=e.delay,n=null,i=function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];clearTimeout(n),n=setTimeout(function(){return t.apply(void 0,s)},r)};return i};F.debounce=Zi;var Vi=function(e,t){var r=e.interval,n=!0,i=function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];!n||(t.apply(void 0,s),n=!1,setTimeout(function(){n=!0},r))};return i};F.throttle=Vi});var Ur=W(vt=>{"use strict";vt.__esModule=!0;vt.toInt=vt.toFloat=void 0;var Hi=function(e,t){if(t===void 0&&(t=0),e==null)return t;var r=parseFloat(e);return isNaN(r)?t:r};vt.toFloat=Hi;var $i=function(e,t){if(t===void 0&&(t=0),e==null)return t;var r=parseInt(e);return isNaN(r)?t:r};vt.toInt=$i});var Ue=W(I=>{"use strict";I.__esModule=!0;I.isEmpty=I.isNumber=I.isFloat=I.isInt=I.isString=I.isFunction=I.isObject=I.isArray=I.isSymbol=void 0;var Ji=function(e){return!!e&&e.constructor===Symbol};I.isSymbol=Ji;var Qi=function(e){return!!e&&e.constructor===Array};I.isArray=Qi;var ts=function(e){return!!e&&e.constructor===Object};I.isObject=ts;var es=function(e){return!!(e&&e.constructor&&e.call&&e.apply)};I.isFunction=es;var rs=function(e){return typeof e=="string"||e instanceof String};I.isString=rs;var ns=function(e){return Number(e)===e&&e%1===0};I.isInt=ns;var is=function(e){return Number(e)===e&&e%1!==0};I.isFloat=is;var ss=function(e){return Number(e)===e};I.isNumber=ss;var os=function(e){if(e===!0||e===!1||(0,I.isNumber)(e)||e==null)return!0;var t=e.length;if((0,I.isNumber)(t))return t===0;var r=e.size;if((0,I.isNumber)(r))return r===0;var n=Object.keys(e).length;return n===0};I.isEmpty=os});var jr=W(T=>{"use strict";var M=T&&T.__assign||function(){return M=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},M.apply(this,arguments)},Gr=T&&T.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,s;n<i;n++)(s||!(n in t))&&(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))};T.__esModule=!0;T.zip=T.get=T.omit=T.pick=T.listify=T.clone=T.upperize=T.lowerize=T.invert=T.mapEntries=T.mapValues=T.mapKeys=T.shake=void 0;var as=Ue(),us=function(e,t){return t===void 0&&(t=function(r){return r===void 0}),e?Object.keys(e).reduce(function(r,n){var i;return t(e[n])?r:M(M({},r),(i={},i[n]=e[n],i))},{}):{}};T.shake=us;var ls=function(e,t){return Object.keys(e).reduce(function(r,n){var i;return M(M({},r),(i={},i[t(n,e[n])]=e[n],i))},{})};T.mapKeys=ls;var cs=function(e,t){return Object.keys(e).reduce(function(r,n){var i;return M(M({},r),(i={},i[n]=t(e[n],n),i))},{})};T.mapValues=cs;var fs=function(e,t){return e?Object.entries(e).reduce(function(r,n){var i,s=n[0],o=n[1],u=t(s,o),l=u[0],a=u[1];return M(M({},r),(i={},i[l]=a,i))},{}):{}};T.mapEntries=fs;var hs=function(e){return e?Object.keys(e).reduce(function(t,r){var n;return M(M({},t),(n={},n[e[r]]=r,n))},{}):{}};T.invert=hs;var ds=function(e){return(0,T.mapKeys)(e,function(t){return t.toLowerCase()})};T.lowerize=ds;var ps=function(e){return(0,T.mapKeys)(e,function(t){return t.toUpperCase()})};T.upperize=ps;var ms=function(e){return Object.getOwnPropertyNames(e).reduce(function(t,r){var n;return M(M({},t),(n={},n[r]=e[r],n))},{})};T.clone=ms;var gs=function(e,t){if(!e)return[];var r=Object.entries(e);return r.length===0?[]:r.reduce(function(n,i){return Gr(Gr([],n,!0),[t(i[0],i[1])],!1)},[])};T.listify=gs;var _s=function(e,t){return e?t.reduce(function(r,n){var i;return M(M({},r),(i={},i[n]=e[n],i))},{}):{}};T.pick=_s;var ys=function(e,t){return e?!t||t.length===0?e:t.reduce(function(r,n){return delete r[n],r},M({},e)):{}};T.omit=ys;var vs=function(e,t,r){var n;r===void 0&&(r=null);try{return(n=t(e))!==null&&n!==void 0?n:r}catch{return r}};T.get=vs;var xs=function(e,t){return!e&&!t?{}:e?t?Object.entries(e).reduce(function(r,n){var i,s=n[0],o=n[1];return M(M({},r),(i={},i[s]=function(){return(0,as.isObject)(o)?(0,T.zip)(o,t[s]):t[s]}(),i))},{}):e:t};T.zip=xs});var Xr=W(q=>{"use strict";q.__esModule=!0;q.uid=q.shuffle=q.draw=q.random=void 0;var Es=re(),Ts=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)};q.random=Ts;var bs=function(e){var t=e.length;if(t===0)return null;var r=(0,q.random)(0,t-1);return e[r]};q.draw=bs;var ws=function(e){return e.map(function(t){return{rand:Math.random(),value:t}}).sort(function(t,r){return t.rand-r.rand}).map(function(t){return t.value})};q.shuffle=ws;var Cs=function(e,t){t===void 0&&(t="");var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"+t;return(0,Es.iterate)(e,function(n){return n+r.charAt((0,q.random)(0,r.length-1))},"")};q.uid=Cs});var Dr=W(Et=>{"use strict";var xt=Et&&Et.__assign||function(){return xt=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},xt.apply(this,arguments)};Et.__esModule=!0;Et.series=void 0;var Ss=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e.reduce(function(s,o,u){var l,a;return{itemsByValue:xt(xt({},s.itemsByValue),(l={},l[o]=u,l)),itemsByIndex:xt(xt({},s.itemsByIndex),(a={},a[u]=o,a))}},{itemsByValue:{},itemsByIndex:{}}),n=r.itemsByValue,i=r.itemsByIndex;return{min:function(s,o){return n[s]<n[o]?s:o},max:function(s,o){return n[s]>n[o]?s:o},first:function(){return i[0]},last:function(){return i[e.length-1]},next:function(s,o){var u;return(u=i[n[s]+1])!==null&&u!==void 0?u:o},previous:function(s,o){var u;return(u=i[n[s]-1])!==null&&u!==void 0?u:o}}};Et.series=Ss});var Nr=W(O=>{"use strict";O.__esModule=!0;O.template=O.dash=O._dash=O.snake=O._snake=O.camal=O._camal=O.capitalize=void 0;var Rs=function(e){if(!e||e.length===0)return"";var t=e.toLowerCase();return t.substring(0,1).toUpperCase()+t.substring(1,t.length)};O.capitalize=Rs;var Ps=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.length===0?"":e.length===1?e[0]:e.reduce(function(r,n){return""+r+n.charAt(0).toUpperCase()+n.slice(1)})};O._camal=Ps;var Is=function(e){return O._camal.apply(void 0,e.split(/[\.\-\s_]/).map(function(t){return t.toLowerCase()}))};O.camal=Is;var Fs=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.length===0?"":e.length===1?e[0]:e.reduce(function(r,n){return r+"_"+n.toLowerCase()})};O._snake=Fs;var Os=function(e){return O._snake.apply(void 0,e.split(/[\.\-\s_]/).map(function(t){return t.toLowerCase()}))};O.snake=Os;var As=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.length===0?"":e.length===1?e[0]:e.reduce(function(r,n){return r+"-"+n.toLowerCase()})};O._dash=As;var Ms=function(e){return O._dash.apply(void 0,e.split(/[\.\-\s_]/).map(function(t){return t.toLowerCase()}))};O.dash=Ms;var Ls=function(e,t,r){return r===void 0&&(r=/\{\{(.+?)\}\}/g),Array.from(e.matchAll(r)).reduce(function(n,i){return n.replace(i[0],t[i[1]])},e)};O.template=Ls});var Ge=W(c=>{"use strict";var h=c&&c.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]});c.__esModule=!0;c.mapKeys=c.mapEntries=c.lowerize=c.listify=c.invert=c.get=c.clone=c.toInt=c.toFloat=c.throttle=c.proxied=c.partob=c.partial=c.memo=c.debounce=c.compose=c.chain=c.tryit=c.try=c.sleep=c.retry=c.reduce=c.parallel=c.map=c.defer=c.unique=c.sum=c.sort=c.sift=c.select=c.replaceOrAppend=c.replace=c.range=c.objectify=c.min=c.merge=c.max=c.list=c.last=c.iterate=c.intersects=c.group=c.fork=c.flat=c.first=c.diff=c.counting=c.cluster=c.boil=c.alphabetical=void 0;c.isSymbol=c.isString=c.isObject=c.isInt=c.isFloat=c.isNumber=c.isFunction=c.isEmpty=c.isArray=c.template=c.snake=c.dash=c.capitalize=c.camal=c.series=c.uid=c.shuffle=c.random=c.draw=c.zip=c.upperize=c.shake=c.pick=c.omit=c.mapValues=void 0;var P=re();h(c,P,"alphabetical");h(c,P,"boil");h(c,P,"cluster");h(c,P,"counting");h(c,P,"diff");h(c,P,"first");h(c,P,"flat");h(c,P,"fork");h(c,P,"group");h(c,P,"intersects");h(c,P,"iterate");h(c,P,"last");h(c,P,"list");h(c,P,"max");h(c,P,"merge");h(c,P,"min");h(c,P,"objectify");h(c,P,"range");h(c,P,"replace");h(c,P,"replaceOrAppend");h(c,P,"select");h(c,P,"sift");h(c,P,"sort");h(c,P,"sum");h(c,P,"unique");var H=Ar();h(c,H,"defer");h(c,H,"map");h(c,H,"parallel");h(c,H,"reduce");h(c,H,"retry");h(c,H,"sleep");h(c,H,"tryit","try");h(c,H,"tryit");var $=Lr();h(c,$,"chain");h(c,$,"compose");h(c,$,"debounce");h(c,$,"memo");h(c,$,"partial");h(c,$,"partob");h(c,$,"proxied");h(c,$,"throttle");var kr=Ur();h(c,kr,"toFloat");h(c,kr,"toInt");var N=jr();h(c,N,"clone");h(c,N,"get");h(c,N,"invert");h(c,N,"listify");h(c,N,"lowerize");h(c,N,"mapEntries");h(c,N,"mapKeys");h(c,N,"mapValues");h(c,N,"omit");h(c,N,"pick");h(c,N,"shake");h(c,N,"upperize");h(c,N,"zip");var se=Xr();h(c,se,"draw");h(c,se,"random");h(c,se,"shuffle");h(c,se,"uid");var Us=Dr();h(c,Us,"series");var Nt=Nr();h(c,Nt,"camal");h(c,Nt,"capitalize");h(c,Nt,"dash");h(c,Nt,"snake");h(c,Nt,"template");var Z=Ue();h(c,Z,"isArray");h(c,Z,"isEmpty");h(c,Z,"isFunction");h(c,Z,"isNumber");h(c,Z,"isFloat");h(c,Z,"isInt");h(c,Z,"isObject");h(c,Z,"isString");h(c,Z,"isSymbol")});var jt=class extends Error{constructor(t,r,n){let i=t.status||t.status===0?t.status:"",s=t.statusText||"",o=`${i} ${s}`.trim(),u=o?`status code ${o}`:"an unknown error";super(`Request failed with ${u}`),Object.defineProperty(this,"response",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="HTTPError",this.response=t,this.request=r,this.options=n}};var yt=class extends Error{constructor(t){super("Request timed out"),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="TimeoutError",this.request=t}};var Xt=e=>e!==null&&typeof e=="object";var Dt=(...e)=>{for(let t of e)if((!Xt(t)||Array.isArray(t))&&typeof t<"u")throw new TypeError("The `options` argument must be an object");return Jt({},...e)},Ae=(e={},t={})=>{let r=new globalThis.Headers(e),n=t instanceof globalThis.Headers,i=new globalThis.Headers(t);for(let[s,o]of i.entries())n&&o==="undefined"||o===void 0?r.delete(s):r.set(s,o);return r},Jt=(...e)=>{let t={},r={};for(let n of e)if(Array.isArray(n))Array.isArray(t)||(t=[]),t=[...t,...n];else if(Xt(n)){for(let[i,s]of Object.entries(n))Xt(s)&&i in t&&(s=Jt(t[i],s)),t={...t,[i]:s};Xt(n.headers)&&(r=Ae(r,n.headers),t.headers=r)}return t};var Me=(()=>{let e=!1,t=!1;return typeof globalThis.ReadableStream=="function"&&(t=new globalThis.Request("https://a.com",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type")),e&&!t})(),xr=typeof globalThis.AbortController=="function",Er=typeof globalThis.FormData=="function",Qt=["get","post","put","patch","head","delete"],ii=()=>{};ii();var Tr={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*"},te=2147483647,ee=Symbol("stop");var wr=e=>Qt.includes(e)?e.toUpperCase():e,si=["get","put","head","delete","options","trace"],oi=[408,413,429,500,502,503,504],Cr=[413,429,503],br={limit:2,methods:si,statusCodes:oi,afterStatusCodes:Cr,maxRetryAfter:Number.POSITIVE_INFINITY},Sr=(e={})=>{if(typeof e=="number")return{...br,limit:e};if(e.methods&&!Array.isArray(e.methods))throw new Error("retry.methods must be an array");if(e.statusCodes&&!Array.isArray(e.statusCodes))throw new Error("retry.statusCodes must be an array");return{...br,...e,afterStatusCodes:Cr}};var Rr=async(e,t,r)=>new Promise((n,i)=>{let s=setTimeout(()=>{t&&t.abort(),i(new yt(e))},r.timeout);r.fetch(e).then(n).catch(i).then(()=>{clearTimeout(s)})}),Pr=async e=>new Promise(t=>{setTimeout(t,e)});var ut=class{constructor(t,r={}){if(Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"abortController",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_retryCount",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_input",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._input=t,this._options={credentials:this._input.credentials||"same-origin",...r,headers:Ae(this._input.headers,r.headers),hooks:Jt({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},r.hooks),method:wr(r.method??this._input.method),prefixUrl:String(r.prefixUrl||""),retry:Sr(r.retry),throwHttpErrors:r.throwHttpErrors!==!1,timeout:typeof r.timeout>"u"?1e4:r.timeout,fetch:r.fetch??globalThis.fetch.bind(globalThis)},typeof this._input!="string"&&!(this._input instanceof URL||this._input instanceof globalThis.Request))throw new TypeError("`input` must be a string, URL, or Request");if(this._options.prefixUrl&&typeof this._input=="string"){if(this._input.startsWith("/"))throw new Error("`input` must not begin with a slash when using `prefixUrl`");this._options.prefixUrl.endsWith("/")||(this._options.prefixUrl+="/"),this._input=this._options.prefixUrl+this._input}if(xr&&(this.abortController=new globalThis.AbortController,this._options.signal&&this._options.signal.addEventListener("abort",()=>{this.abortController.abort()}),this._options.signal=this.abortController.signal),this.request=new globalThis.Request(this._input,this._options),Me&&(this.request.duplex="half"),this._options.searchParams){let n=typeof this._options.searchParams=="string"?this._options.searchParams.replace(/^\?/,""):new URLSearchParams(this._options.searchParams).toString(),i="?"+n,s=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,i);(Er&&this._options.body instanceof globalThis.FormData||this._options.body instanceof URLSearchParams)&&!(this._options.headers&&this._options.headers["content-type"])&&this.request.headers.delete("content-type"),this.request=new globalThis.Request(new globalThis.Request(s,this.request),this._options)}this._options.json!==void 0&&(this._options.body=JSON.stringify(this._options.json),this.request.headers.set("content-type",this._options.headers.get("content-type")??"application/json"),this.request=new globalThis.Request(this.request,{body:this._options.body}))}static create(t,r){let n=new ut(t,r),i=async()=>{if(n._options.timeout>te)throw new RangeError(`The \`timeout\` option cannot be greater than ${te}`);await Promise.resolve();let u=await n._fetch();for(let l of n._options.hooks.afterResponse){let a=await l(n.request,n._options,n._decorateResponse(u.clone()));a instanceof globalThis.Response&&(u=a)}if(n._decorateResponse(u),!u.ok&&n._options.throwHttpErrors){let l=new jt(u,n.request,n._options);for(let a of n._options.hooks.beforeError)l=await a(l);throw l}if(n._options.onDownloadProgress){if(typeof n._options.onDownloadProgress!="function")throw new TypeError("The `onDownloadProgress` option must be a function");if(!Me)throw new Error("Streams are not supported in your environment. `ReadableStream` is missing.");return n._stream(u.clone(),n._options.onDownloadProgress)}return u},o=n._options.retry.methods.includes(n.request.method.toLowerCase())?n._retry(i):i();for(let[u,l]of Object.entries(Tr))o[u]=async()=>{n.request.headers.set("accept",n.request.headers.get("accept")||l);let f=(await o).clone();if(u==="json"){if(f.status===204)return"";if(r.parseJson)return r.parseJson(await f.text())}return f[u]()};return o}_calculateRetryDelay(t){if(this._retryCount++,this._retryCount<this._options.retry.limit&&!(t instanceof yt)){if(t instanceof jt){if(!this._options.retry.statusCodes.includes(t.response.status))return 0;let n=t.response.headers.get("Retry-After");if(n&&this._options.retry.afterStatusCodes.includes(t.response.status)){let i=Number(n);return Number.isNaN(i)?i=Date.parse(n)-Date.now():i*=1e3,typeof this._options.retry.maxRetryAfter<"u"&&i>this._options.retry.maxRetryAfter?0:i}if(t.response.status===413)return 0}return .3*2**(this._retryCount-1)*1e3}return 0}_decorateResponse(t){return this._options.parseJson&&(t.json=async()=>this._options.parseJson(await t.text())),t}async _retry(t){try{return await t()}catch(r){let n=Math.min(this._calculateRetryDelay(r),te);if(n!==0&&this._retryCount>0){await Pr(n);for(let i of this._options.hooks.beforeRetry)if(await i({request:this.request,options:this._options,error:r,retryCount:this._retryCount})===ee)return;return this._retry(t)}throw r}}async _fetch(){for(let t of this._options.hooks.beforeRequest){let r=await t(this.request,this._options);if(r instanceof Request){this.request=r;break}if(r instanceof Response)return r}return this._options.timeout===!1?this._options.fetch(this.request.clone()):Rr(this.request.clone(),this.abortController,this._options)}_stream(t,r){let n=Number(t.headers.get("content-length"))||0,i=0;return t.status===204?(r&&r({percent:1,totalBytes:n,transferredBytes:i},new Uint8Array),new globalThis.Response(null,{status:t.status,statusText:t.statusText,headers:t.headers})):new globalThis.Response(new globalThis.ReadableStream({async start(s){let o=t.body.getReader();r&&r({percent:0,transferredBytes:0,totalBytes:n},new Uint8Array);async function u(){let{done:l,value:a}=await o.read();if(l){s.close();return}if(r){i+=a.byteLength;let f=n===0?0:i/n;r({percent:f,transferredBytes:i,totalBytes:n},a)}s.enqueue(a),await u()}await u()}}),{status:t.status,statusText:t.statusText,headers:t.headers})}};var Le=e=>{let t=(r,n)=>ut.create(r,Dt(e,n));for(let r of Qt)t[r]=(n,i)=>ut.create(n,Dt(e,i,{method:r}));return t.create=r=>Le(Dt(r)),t.extend=r=>Le(Dt(e,r)),t.stop=ee,t},ai=Le(),Ir=ai;var Yr=vr(Ge());function Gs(e){return(typeof e=="number"||typeof e=="string"&&e.trim()!=="")&&!isNaN(e)}function qr(e){return Gs(e)?parseFloat(e):e}var js={POINT(e){return{type:"Point",coordinates:[e.points[0].x,e.points[0].y]}},REGION(e){if(e.parts.length===1)return{type:"Polygon",coordinates:[e.points.map(n=>[n.x,n.y])]};let t={type:"MultiPolygon",coordinates:[]},r=0;for(let n of e.parts){let i=[e.points.slice(r,r+n).map(s=>[s.x,s.y])];r+=n,t.coordinates.push(i)}return t}};function Wr(e,t=!0){let r={type:"FeatureCollection",features:[]};for(let n of e){let i=n.geometry.type,s=js[i](n.geometry),o={};for(let l of(0,Yr.range)(0,n.fieldNames.length-1))o[n.fieldNames[l]]=t?qr(n.fieldValues[l]):n.fieldValues[l];let u={type:"Feature",geometry:s,properties:o};r.features.push(u)}return r}async function zr(e,t,r={}){let n=await Ir.post(`${e}/featureResults.json`,{...r,searchParams:{returnContent:!0,fromIndex:t.fromIndex??0,toIndex:t.toIndex??-1,...t.token!=null&&{token:t.token}},json:{datasetNames:[`${t.datasource}:${t.dataset}`],getFeatureMode:"SQL",queryParameter:{name:`${t.dataset}@${t.datasource}`,attributeFilter:t.filter.select}}}).json();if(n.error!=null&&n.succeed===!1)throw new Error(`${n.error.code}: ${n.error.errorMsg}`);return Wr(n.features,t.typeCast)}var Kr=vr(Ge()),je=["SMAREA","SMGEOMETRY","SMID","SMPERIMETER","SMUSERID","USERID"];function Br(e){return(0,Kr.omit)(e,je)}var Xe=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}};var J=Xe;var L={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};var Xs={1:"The view center is not defined",2:"The view resolution is not defined",3:"The view rotation is not defined",4:"`image` and `src` cannot be provided at the same time",5:"`imgSize` must be set when `image` is provided",7:"`format` must be set when `url` is set",8:"Unknown `serverType` configured",9:"`url` must be configured or set using `#setUrl()`",10:"The default `geometryFunction` can only handle `Point` geometries",11:"`options.featureTypes` must be an Array",12:"`options.geometryName` must also be provided when `options.bbox` is set",13:"Invalid corner",14:"Invalid color",15:"Tried to get a value for a key that does not exist in the cache",16:"Tried to set a value for a key that is used already",17:"`resolutions` must be sorted in descending order",18:"Either `origin` or `origins` must be configured, never both",19:"Number of `tileSizes` and `resolutions` must be equal",20:"Number of `origins` and `resolutions` must be equal",22:"Either `tileSize` or `tileSizes` must be configured, never both",24:"Invalid extent or geometry provided as `geometry`",25:"Cannot fit empty extent provided as `geometry`",26:"Features must have an id set",27:"Features must have an id set",28:'`renderMode` must be `"hybrid"` or `"vector"`',30:"The passed `feature` was already added to the source",31:"Tried to enqueue an `element` that was already added to the queue",32:"Transformation matrix cannot be inverted",33:"Invalid units",34:"Invalid geometry layout",36:"Unknown SRS type",37:"Unknown geometry type found",38:"`styleMapValue` has an unknown type",39:"Unknown geometry type",40:"Expected `feature` to have a geometry",41:"Expected an `ol/style/Style` or an array of `ol/style/Style.js`",42:"Question unknown, the answer is 42",43:"Expected `layers` to be an array or a `Collection`",47:"Expected `controls` to be an array or an `ol/Collection`",48:"Expected `interactions` to be an array or an `ol/Collection`",49:"Expected `overlays` to be an array or an `ol/Collection`",50:"`options.featureTypes` should be an Array",51:"Either `url` or `tileJSON` options must be provided",52:"Unknown `serverType` configured",53:"Unknown `tierSizeCalculation` configured",55:"The {-y} placeholder requires a tile grid with extent",56:"mapBrowserEvent must originate from a pointer event",57:"At least 2 conditions are required",59:"Invalid command found in the PBF",60:"Missing or invalid `size`",61:"Cannot determine IIIF Image API version from provided image information JSON",62:"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`",64:"Layer opacity must be a number",66:"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`",67:"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both",68:"A VectorTile source can only be rendered if it has a projection compatible with the view projection"},De=class extends Error{constructor(t){let r=Xs[t];super(r),this.code=t,this.name="AssertionError",this.message=r}},Zr=De;function G(e,t){if(!e)throw new Zr(t)}function Ne(e){let t=Q();for(let r=0,n=e.length;r<n;++r)kt(t,e[r]);return t}function oe(e,t){return Ds(e,t[0],t[1])}function Hr(e,t){return e[0]<=t[0]&&t[2]<=e[2]&&e[1]<=t[1]&&t[3]<=e[3]}function Ds(e,t,r){return e[0]<=t&&t<=e[2]&&e[1]<=r&&r<=e[3]}function Vr(e,t){let r=e[0],n=e[1],i=e[2],s=e[3],o=t[0],u=t[1],l=L.UNKNOWN;return o<r?l=l|L.LEFT:o>i&&(l=l|L.RIGHT),u<n?l=l|L.BELOW:u>s&&(l=l|L.ABOVE),l===L.UNKNOWN&&(l=L.INTERSECTING),l}function Q(){return[1/0,1/0,-1/0,-1/0]}function Tt(e,t,r,n,i){return i?(i[0]=e,i[1]=t,i[2]=r,i[3]=n,i):[e,t,r,n]}function Ns(e){return Tt(1/0,1/0,-1/0,-1/0,e)}function $r(e,t){return t[0]<e[0]&&(e[0]=t[0]),t[2]>e[2]&&(e[2]=t[2]),t[1]<e[1]&&(e[1]=t[1]),t[3]>e[3]&&(e[3]=t[3]),e}function kt(e,t){t[0]<e[0]&&(e[0]=t[0]),t[0]>e[2]&&(e[2]=t[0]),t[1]<e[1]&&(e[1]=t[1]),t[1]>e[3]&&(e[3]=t[1])}function Jr(e,t,r,n,i){for(;r<n;r+=i)ks(e,t[r],t[r+1]);return e}function ks(e,t,r){e[0]=Math.min(e[0],t),e[1]=Math.min(e[1],r),e[2]=Math.max(e[2],t),e[3]=Math.max(e[3],r)}function Qr(e,t){let r;return r=t(ae(e)),r||(r=t(ue(e)),r)||(r=t(fe(e)),r)||(r=t(tt(e)),r)?r:!1}function qt(e){let t=0;return qs(e)||(t=j(e)*bt(e)),t}function ae(e){return[e[0],e[1]]}function ue(e){return[e[2],e[1]]}function le(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]}function tn(e,t){let r;return t==="bottom-left"?r=ae(e):t==="bottom-right"?r=ue(e):t==="top-left"?r=tt(e):t==="top-right"?r=fe(e):G(!1,13),r}function bt(e){return e[3]-e[1]}function ce(e,t,r){let n=r||Q();return Yt(e,t)?(e[0]>t[0]?n[0]=e[0]:n[0]=t[0],e[1]>t[1]?n[1]=e[1]:n[1]=t[1],e[2]<t[2]?n[2]=e[2]:n[2]=t[2],e[3]<t[3]?n[3]=e[3]:n[3]=t[3]):Ns(n),n}function tt(e){return[e[0],e[3]]}function fe(e){return[e[2],e[3]]}function j(e){return e[2]-e[0]}function Yt(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]}function qs(e){return e[2]<e[0]||e[3]<e[1]}function en(e,t,r){let n=!1,i=Vr(e,t),s=Vr(e,r);if(i===L.INTERSECTING||s===L.INTERSECTING)n=!0;else{let o=e[0],u=e[1],l=e[2],a=e[3],f=t[0],p=t[1],d=r[0],v=r[1],x=(v-p)/(d-f),g,w;!!(s&L.ABOVE)&&!(i&L.ABOVE)&&(g=d-(v-a)/x,n=g>=o&&g<=l),!n&&!!(s&L.RIGHT)&&!(i&L.RIGHT)&&(w=v-(d-l)*x,n=w>=u&&w<=a),!n&&!!(s&L.BELOW)&&!(i&L.BELOW)&&(g=d-(v-u)/x,n=g>=o&&g<=l),!n&&!!(s&L.LEFT)&&!(i&L.LEFT)&&(w=v-(d-o)*x,n=w>=u&&w<=a)}return n}var rn={PROPERTYCHANGE:"propertychange"};var ke=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}},nn=ke;function Ys(e,t){return e>t?1:e<t?-1:0}function sn(e,t,r){let n=e.length;if(e[0]<=t)return 0;if(t<=e[n-1])return n-1;{let i;if(r>0){for(i=1;i<n;++i)if(e[i]<t)return i-1}else if(r<0){for(i=1;i<n;++i)if(e[i]<=t)return i}else for(i=1;i<n;++i){if(e[i]==t)return i;if(e[i]<t)return typeof r=="function"?r(t,e[i-1],e[i])>0?i-1:i:e[i-1]-t<t-e[i]?i-1:i}return n-1}}function on(e,t,r){let n=t||Ys;return e.every(function(i,s){if(s===0)return!0;let o=n(e[s-1],i);return!(o>0||r&&o===0)})}function qe(){}function he(e){for(let t in e)delete e[t]}function an(e){let t;for(t in e)return!1;return!t}var Ye=class extends nn{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,r){if(!t||!r)return;let n=this.listeners_||(this.listeners_={}),i=n[t]||(n[t]=[]);i.includes(r)||i.push(r)}dispatchEvent(t){let r=typeof t=="string",n=r?t:t.type,i=this.listeners_&&this.listeners_[n];if(!i)return;let s=r?new J(t):t;s.target||(s.target=this.eventTarget_||this);let o=this.dispatching_||(this.dispatching_={}),u=this.pendingRemovals_||(this.pendingRemovals_={});n in o||(o[n]=0,u[n]=0),++o[n];let l;for(let a=0,f=i.length;a<f;++a)if("handleEvent"in i[a]?l=i[a].handleEvent(s):l=i[a].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[n]===0){let a=u[n];for(delete u[n];a--;)this.removeEventListener(n,qe);delete o[n]}return l}disposeInternal(){this.listeners_&&he(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,r){let n=this.listeners_&&this.listeners_[t];if(n){let i=n.indexOf(r);i!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[i]=qe,++this.pendingRemovals_[t]):(n.splice(i,1),n.length===0&&delete this.listeners_[t]))}}},de=Ye;var Y={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function wt(e,t,r,n,i){if(n&&n!==e&&(r=r.bind(n)),i){let o=r;r=function(){e.removeEventListener(t,r),o.apply(this,arguments)}}let s={target:e,type:t,listener:r};return e.addEventListener(t,r),s}function Ct(e,t,r,n){return wt(e,t,r,n,!0)}function et(e){e&&e.target&&(e.target.removeEventListener(e.type,e.listener),he(e))}var St=class extends de{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(Y.CHANGE)}getRevision(){return this.revision_}onInternal(t,r){if(Array.isArray(t)){let n=t.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=wt(this,t[s],r);return i}else return wt(this,t,r)}onceInternal(t,r){let n;if(Array.isArray(t)){let i=t.length;n=new Array(i);for(let s=0;s<i;++s)n[s]=Ct(this,t[s],r)}else n=Ct(this,t,r);return r.ol_key=n,n}unInternal(t,r){let n=r.ol_key;if(n)Ws(n);else if(Array.isArray(t))for(let i=0,s=t.length;i<s;++i)this.removeEventListener(t[i],r);else this.removeEventListener(t,r)}};St.prototype.on;St.prototype.once;St.prototype.un;function Ws(e){if(Array.isArray(e))for(let t=0,r=e.length;t<r;++t)et(e[t]);else et(e)}var un=St;function Rt(){throw new Error("Unimplemented abstract method.")}var zs=0;function rt(e){return e.ol_uid||(e.ol_uid=String(++zs))}var pe=class extends J{constructor(t,r,n){super(t),this.key=r,this.oldValue=n}},We=class extends un{constructor(t){super(),this.on,this.once,this.un,rt(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let r;return this.values_&&this.values_.hasOwnProperty(t)&&(r=this.values_[t]),r}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}hasProperties(){return!!this.values_}notify(t,r){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new pe(n,t,r)),n=rn.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new pe(n,t,r))}addChangeListener(t,r){this.addEventListener(`change:${t}`,r)}removeChangeListener(t,r){this.removeEventListener(`change:${t}`,r)}set(t,r,n){let i=this.values_||(this.values_={});if(n)i[t]=r;else{let s=i[t];i[t]=r,s!==r&&this.notify(t,s)}}setProperties(t,r){for(let n in t)this.set(n,t[n],r)}applyProperties(t){!t.values_||Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,r){if(this.values_&&t in this.values_){let n=this.values_[t];delete this.values_[t],an(this.values_)&&(this.values_=null),r||this.notify(t,n)}}},ln=We;var nt=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",Wa=nt.includes("firefox"),Ks=nt.includes("safari")&&!nt.includes("chrom"),za=Ks&&(nt.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(nt)),Ka=nt.includes("webkit")&&!nt.includes("edge"),Ba=nt.includes("macintosh");var cn=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,fn=typeof Image<"u"&&Image.prototype.decode,Za=function(){let e=!1;try{let t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return e}();var ft={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};var ze=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||ft[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}},me=ze;var Wt=6378137,Pt=Math.PI*Wt,Bs=[-Pt,-Pt,Pt,Pt],Zs=[-180,-85,180,85],ge=Wt*Math.log(Math.tan(Math.PI/2)),it=class extends me{constructor(t){super({code:t,units:"m",extent:Bs,global:!0,worldExtent:Zs,getPointResolution:function(r,n){return r/Math.cosh(n[1]/Wt)}})}},Ke=[new it("EPSG:3857"),new it("EPSG:102100"),new it("EPSG:102113"),new it("EPSG:900913"),new it("http://www.opengis.net/def/crs/EPSG/0/3857"),new it("http://www.opengis.net/gml/srs/epsg.xml#3857")];function hn(e,t,r){let n=e.length;r=r>1?r:2,t===void 0&&(r>2?t=e.slice():t=new Array(n));for(let i=0;i<n;i+=r){t[i]=Pt*e[i]/180;let s=Wt*Math.log(Math.tan(Math.PI*(+e[i+1]+90)/360));s>ge?s=ge:s<-ge&&(s=-ge),t[i+1]=s}return t}function dn(e,t,r){let n=e.length;r=r>1?r:2,t===void 0&&(r>2?t=e.slice():t=new Array(n));for(let i=0;i<n;i+=r)t[i]=180*e[i]/Pt,t[i+1]=360*Math.atan(Math.exp(e[i+1]/Wt))/Math.PI-90;return t}var Vs=6378137,pn=[-180,-90,180,90],Hs=Math.PI*Vs/180,V=class extends me{constructor(t,r){super({code:t,units:"degrees",extent:pn,axisOrientation:r,global:!0,metersPerUnit:Hs,worldExtent:pn})}},Be=[new V("CRS:84"),new V("EPSG:4326","neu"),new V("urn:ogc:def:crs:OGC:1.3:CRS84"),new V("urn:ogc:def:crs:OGC:2:84"),new V("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new V("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new V("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];var Ze={};function mn(e){return Ze[e]||Ze[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function gn(e,t){Ze[e]=t}var It={};function zt(e,t,r){let n=e.getCode(),i=t.getCode();n in It||(It[n]={}),It[n][i]=r}function _n(e,t){let r;return e in It&&t in It[e]&&(r=It[e][t]),r}function Kt(e,t,r){return Math.min(Math.max(e,t),r)}function yn(e){let t=e.length;for(let n=0;n<t;n++){let i=n,s=Math.abs(e[n][n]);for(let u=n+1;u<t;u++){let l=Math.abs(e[u][n]);l>s&&(s=l,i=u)}if(s===0)return null;let o=e[i];e[i]=e[n],e[n]=o;for(let u=n+1;u<t;u++){let l=-e[u][n]/e[n][n];for(let a=n;a<t+1;a++)n==a?e[u][a]=0:e[u][a]+=l*e[n][a]}}let r=new Array(t);for(let n=t-1;n>=0;n--){r[n]=e[n][t]/e[n][n];for(let i=n-1;i>=0;i--)e[i][t]-=e[i][n]*r[n]}return r}function _e(e){return e*Math.PI/180}function Ft(e,t){let r=e%t;return r*t<0?r+t:r}function vn(e,t){let r=Math.pow(10,t);return Math.round(e*r)/r}function Bt(e,t){return Math.floor(vn(e,t))}function Zt(e,t){return Math.ceil(vn(e,t))}var $s=63710088e-1;function Ve(e,t,r){r=r||$s;let n=_e(e[1]),i=_e(t[1]),s=(i-n)/2,o=_e(t[0]-e[0])/2,u=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(n)*Math.cos(i);return 2*r*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))}function He(e,t,r){if(t!==void 0){for(let n=0,i=e.length;n<i;++n)t[n]=e[n];t=t}else t=e.slice();return t}function En(e,t,r){if(t!==void 0&&e!==t){for(let n=0,i=e.length;n<i;++n)t[n]=e[n];e=t}return e}function Js(e){gn(e.getCode(),e),zt(e,e,He)}function Qs(e){e.forEach(Js)}function z(e){return typeof e=="string"?mn(e):e||null}function $e(e,t,r,n){e=z(e);let i,s=e.getPointResolutionFunc();if(s){if(i=s(t,r),n&&n!==e.getUnits()){let o=e.getMetersPerUnit();o&&(i=i*o/ft[n])}}else{let o=e.getUnits();if(o=="degrees"&&!n||n=="degrees")i=t;else{let u=Je(e,z("EPSG:4326"));if(u===En&&o!=="degrees")i=t*e.getMetersPerUnit();else{let a=[r[0]-t/2,r[1],r[0]+t/2,r[1],r[0],r[1]-t/2,r[0],r[1]+t/2];a=u(a,a,2);let f=Ve(a.slice(0,2),a.slice(2,4)),p=Ve(a.slice(4,6),a.slice(6,8));i=(f+p)/2}let l=n?ft[n]:e.getMetersPerUnit();l!==void 0&&(i/=l)}}return i}function xn(e){Qs(e),e.forEach(function(t){e.forEach(function(r){t!==r&&zt(t,r,He)})})}function to(e,t,r,n){e.forEach(function(i){t.forEach(function(s){zt(i,s,r),zt(s,i,n)})})}function st(e,t){if(e===t)return!0;let r=e.getUnits()===t.getUnits();return(e.getCode()===t.getCode()||Je(e,t)===He)&&r}function Je(e,t){let r=e.getCode(),n=t.getCode(),i=_n(r,n);return i||(i=En),i}function Qe(e,t){let r=z(e),n=z(t);return Je(r,n)}function Tn(e,t,r){return Qe(t,r)(e,void 0,e.length)}function eo(){xn(Ke),xn(Be),to(Be,Ke,hn,dn)}eo();function bn(e,t,r,n,i){let s;for(t+=n;t<r;t+=n)if(s=i(e.slice(t-n,t),e.slice(t,t+n)),s)return s;return!1}function Vt(e,t,r,n,i,s){let o=0,u=e[r-n],l=e[r-n+1];for(;t<r;t+=n){let a=e[t],f=e[t+1];l<=s?f>s&&(a-u)*(s-l)-(i-u)*(f-l)>0&&o++:f<=s&&(a-u)*(s-l)-(i-u)*(f-l)<0&&o--,u=a,l=f}return o!==0}function ro(e,t,r,n,i){let s=Jr(Q(),e,t,r,n);return Yt(i,s)?Hr(i,s)||s[0]>=i[0]&&s[2]<=i[2]||s[1]>=i[1]&&s[3]<=i[3]?!0:bn(e,t,r,n,function(o,u){return en(i,o,u)}):!1}function wn(e,t,r,n,i){return!!(ro(e,t,r,n,i)||Vt(e,t,r,n,i[0],i[1])||Vt(e,t,r,n,i[0],i[3])||Vt(e,t,r,n,i[2],i[1])||Vt(e,t,r,n,i[2],i[3]))}function Cn(e,t,r){return r===void 0&&(r=[0,0]),r[0]=e[0]*t+.5|0,r[1]=e[1]*t+.5|0,r}function k(e,t){return Array.isArray(e)?e:(t===void 0?t=[e,e]:(t[0]=e,t[1]=e),t)}function Ht(e,t,r,n){let i;return r&&r.length?i=r.shift():cn?i=new OffscreenCanvas(e||300,t||300):i=document.createElement("canvas"),e&&(i.width=e),t&&(i.height=t),i.getContext("2d",n)}function Sn(e){let t=e.canvas;t.width=1,t.height=1,e.clearRect(0,0,1,1)}function Rn(e,t,r){let n=e,i=!0,s=!1,o=!1,u=[Ct(n,Y.LOAD,function(){o=!0,s||t()})];return n.src&&fn?(s=!0,n.decode().then(function(){i&&t()}).catch(function(l){i&&(o?t():r())})):u.push(Ct(n,Y.ERROR,r)),function(){i=!1,u.forEach(et)}}var tr=class extends ln{constructor(t){super(),this.projection=z(t.projection),this.attributions_=Pn(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;let r=this;this.viewPromise_=new Promise(function(n,i){r.viewResolver=n,r.viewRejector=i})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(){return Rt()}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Pn(t),this.changed()}setState(t){this.state_=t,this.changed()}};function Pn(e){return e?Array.isArray(e)?function(t){return e}:typeof e=="function"?e:function(t){return[e]}:null}var In=tr;var y={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Fn(e){return Math.pow(e,3)}var er=class extends de{constructor(t,r,n){super(),n=n||{},this.tileCoord=t,this.state=r,this.interimTile=null,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(Y.CHANGE)}release(){this.state===y.ERROR&&this.setState(y.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let t=this.interimTile;do{if(t.getState()==y.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){if(!this.interimTile)return;let t=this.interimTile,r=this;do{if(t.getState()==y.LOADED){t.interimTile=null;break}else t.getState()==y.LOADING?r=t:t.getState()==y.IDLE?r.interimTile=t.interimTile:r=t;t=r.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==y.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){Rt()}getAlpha(t,r){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(!n)n=r,this.transitionStarts_[t]=n;else if(n===-1)return 1;let i=r-n+1e3/60;return i>=this.transition_?1:Fn(i/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}},ye=er;var rr=class extends ye{constructor(t,r,n,i,s,o){super(t,r,o),this.crossOrigin_=i,this.src_=n,this.key=n,this.image_=new Image,i!==null&&(this.image_.crossOrigin=i),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(t){this.image_=t,this.state=y.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=y.ERROR,this.unlistenImage_(),this.image_=no(),this.changed()}handleImageLoad_(){let t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=y.LOADED:this.state=y.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==y.ERROR&&(this.state=y.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==y.IDLE&&(this.state=y.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Rn(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}};function no(){let e=Ht(1,1);return e.fillStyle="rgba(0,0,0,0)",e.fillRect(0,0,1,1),e.canvas}var On=rr;var io=10,An=.25,nr=class{constructor(t,r,n,i,s,o){this.sourceProj_=t,this.targetProj_=r;let u={},l=Qe(this.targetProj_,this.sourceProj_);this.transformInv_=function(b){let _=b[0]+"/"+b[1];return u[_]||(u[_]=l(b)),u[_]},this.maxSourceExtent_=i,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!i&&!!this.sourceProj_.getExtent()&&j(i)==j(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?j(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?j(this.targetProj_.getExtent()):null;let a=tt(n),f=fe(n),p=ue(n),d=ae(n),v=this.transformInv_(a),x=this.transformInv_(f),g=this.transformInv_(p),w=this.transformInv_(d),S=io+(o?Math.max(0,Math.ceil(Math.log2(qt(n)/(o*o*256*256)))):0);if(this.addQuad_(a,f,p,d,v,x,g,w,S),this.wrapsXInSource_){let b=1/0;this.triangles_.forEach(function(_,E,U){b=Math.min(b,_.source[0][0],_.source[1][0],_.source[2][0])}),this.triangles_.forEach(function(_){if(Math.max(_.source[0][0],_.source[1][0],_.source[2][0])-b>this.sourceWorldWidth_/2){let E=[[_.source[0][0],_.source[0][1]],[_.source[1][0],_.source[1][1]],[_.source[2][0],_.source[2][1]]];E[0][0]-b>this.sourceWorldWidth_/2&&(E[0][0]-=this.sourceWorldWidth_),E[1][0]-b>this.sourceWorldWidth_/2&&(E[1][0]-=this.sourceWorldWidth_),E[2][0]-b>this.sourceWorldWidth_/2&&(E[2][0]-=this.sourceWorldWidth_);let U=Math.min(E[0][0],E[1][0],E[2][0]);Math.max(E[0][0],E[1][0],E[2][0])-U<this.sourceWorldWidth_/2&&(_.source=E)}}.bind(this))}u={}}addTriangle_(t,r,n,i,s,o){this.triangles_.push({source:[i,s,o],target:[t,r,n]})}addQuad_(t,r,n,i,s,o,u,l,a){let f=Ne([s,o,u,l]),p=this.sourceWorldWidth_?j(f)/this.sourceWorldWidth_:null,d=this.sourceWorldWidth_,v=this.sourceProj_.canWrapX()&&p>.5&&p<1,x=!1;if(a>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){let w=Ne([t,r,n,i]);x=j(w)/this.targetWorldWidth_>An||x}!v&&this.sourceProj_.isGlobal()&&p&&(x=p>An||x)}if(!x&&this.maxSourceExtent_&&isFinite(f[0])&&isFinite(f[1])&&isFinite(f[2])&&isFinite(f[3])&&!Yt(f,this.maxSourceExtent_))return;let g=0;if(!x&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(u[0])||!isFinite(u[1])||!isFinite(l[0])||!isFinite(l[1]))){if(a>0)x=!0;else if(g=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(u[0])||!isFinite(u[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),g!=1&&g!=2&&g!=4&&g!=8)return}if(a>0){if(!x){let w=[(t[0]+n[0])/2,(t[1]+n[1])/2],S=this.transformInv_(w),b;v?b=(Ft(s[0],d)+Ft(u[0],d))/2-Ft(S[0],d):b=(s[0]+u[0])/2-S[0];let _=(s[1]+u[1])/2-S[1];x=b*b+_*_>this.errorThresholdSquared_}if(x){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){let w=[(r[0]+n[0])/2,(r[1]+n[1])/2],S=this.transformInv_(w),b=[(i[0]+t[0])/2,(i[1]+t[1])/2],_=this.transformInv_(b);this.addQuad_(t,r,w,b,s,o,S,_,a-1),this.addQuad_(b,w,n,i,_,S,u,l,a-1)}else{let w=[(t[0]+r[0])/2,(t[1]+r[1])/2],S=this.transformInv_(w),b=[(n[0]+i[0])/2,(n[1]+i[1])/2],_=this.transformInv_(b);this.addQuad_(t,w,b,i,s,S,_,l,a-1),this.addQuad_(w,r,n,b,S,o,u,_,a-1)}return}}if(v){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(g&11)==0&&this.addTriangle_(t,n,i,s,u,l),(g&14)==0&&this.addTriangle_(t,n,r,s,u,o),g&&((g&13)==0&&this.addTriangle_(r,i,t,o,l,s),(g&7)==0&&this.addTriangle_(r,i,n,o,l,u))}calculateSourceExtent(){let t=Q();return this.triangles_.forEach(function(r,n,i){let s=r.source;kt(t,s[0]),kt(t,s[1]),kt(t,s[2])}),t}getTriangles(){return this.triangles_}},Mn=nr;var ir,or=[];function Ln(e,t,r,n,i){e.beginPath(),e.moveTo(0,0),e.lineTo(t,r),e.lineTo(n,i),e.closePath(),e.save(),e.clip(),e.fillRect(0,0,Math.max(t,n)+1,Math.max(r,i)),e.restore()}function sr(e,t){return Math.abs(e[t*4]-210)>2||Math.abs(e[t*4+3]-.75*255)>2}function so(){if(ir===void 0){let e=document.createElement("canvas").getContext("2d");e.globalCompositeOperation="lighter",e.fillStyle="rgba(210, 0, 0, 0.75)",Ln(e,4,5,4,0),Ln(e,4,5,0,5);let t=e.getImageData(0,0,3,3).data;ir=sr(t,0)||sr(t,4)||sr(t,8)}return ir}function Un(e,t,r,n){let i=Tn(r,t,e),s=$e(t,n,r),o=t.getMetersPerUnit();o!==void 0&&(s*=o);let u=e.getMetersPerUnit();u!==void 0&&(s/=u);let l=e.getExtent();if(!l||oe(l,i)){let a=$e(e,s,i)/s;isFinite(a)&&a>0&&(s/=a)}return s}function Gn(e,t,r,n){let i=le(r),s=Un(e,t,i,n);return(!isFinite(s)||s<=0)&&Qr(r,function(o){return s=Un(e,t,o,n),isFinite(s)&&s>0}),s}function jn(e,t,r,n,i,s,o,u,l,a,f,p){let d=Ht(Math.round(r*e),Math.round(r*t),or);if(p||(d.imageSmoothingEnabled=!1),l.length===0)return d.canvas;d.scale(r,r);function v(E){return Math.round(E*r)/r}d.globalCompositeOperation="lighter";let x=Q();l.forEach(function(E,U,K){$r(x,E.extent)});let g=j(x),w=bt(x),S=Ht(Math.round(r*g/n),Math.round(r*w/n));p||(S.imageSmoothingEnabled=!1);let b=r/n;l.forEach(function(E,U,K){let A=E.extent[0]-x[0],X=-(E.extent[3]-x[3]),B=j(E.extent),pt=bt(E.extent);E.image.width>0&&E.image.height>0&&S.drawImage(E.image,a,a,E.image.width-2*a,E.image.height-2*a,A*b,X*b,B*b,pt*b)});let _=tt(o);return u.getTriangles().forEach(function(E,U,K){let A=E.source,X=E.target,B=A[0][0],pt=A[0][1],Ot=A[1][0],At=A[1][1],Mt=A[2][0],Re=A[2][1],Lt=v((X[0][0]-_[0])/s),Ut=v(-(X[0][1]-_[1])/s),mt=v((X[1][0]-_[0])/s),gt=v(-(X[1][1]-_[1])/s),Pe=v((X[2][0]-_[0])/s),Ie=v(-(X[2][1]-_[1])/s),Fe=B,Oe=pt;B=0,pt=0,Ot-=Fe,At-=Oe,Mt-=Fe,Re-=Oe;let $n=[[Ot,At,0,0,mt-Lt],[Mt,Re,0,0,Pe-Lt],[0,0,Ot,At,gt-Ut],[0,0,Mt,Re,Ie-Ut]],Gt=yn($n);if(!!Gt){if(d.save(),d.beginPath(),so()||!p){d.moveTo(mt,gt);let _t=4,gr=Lt-mt,_r=Ut-gt;for(let at=0;at<_t;at++)d.lineTo(mt+v((at+1)*gr/_t),gt+v(at*_r/(_t-1))),at!=_t-1&&d.lineTo(mt+v((at+1)*gr/_t),gt+v((at+1)*_r/(_t-1)));d.lineTo(Pe,Ie)}else d.moveTo(mt,gt),d.lineTo(Lt,Ut),d.lineTo(Pe,Ie);d.clip(),d.transform(Gt[0],Gt[2],Gt[1],Gt[3],Lt,Ut),d.translate(x[0]-Fe,x[3]-Oe),d.scale(n/r,-n/r),d.drawImage(S.canvas,0,0),d.restore()}}),f&&(d.save(),d.globalCompositeOperation="source-over",d.strokeStyle="black",d.lineWidth=1,u.getTriangles().forEach(function(E,U,K){let A=E.target,X=(A[0][0]-_[0])/s,B=-(A[0][1]-_[1])/s,pt=(A[1][0]-_[0])/s,Ot=-(A[1][1]-_[1])/s,At=(A[2][0]-_[0])/s,Mt=-(A[2][1]-_[1])/s;d.beginPath(),d.moveTo(pt,Ot),d.lineTo(X,B),d.lineTo(At,Mt),d.closePath(),d.stroke()}),d.restore()),d.canvas}var ar=class extends ye{constructor(t,r,n,i,s,o,u,l,a,f,p,d){super(s,y.IDLE,{interpolate:!!d}),this.renderEdges_=p!==void 0?p:!1,this.pixelRatio_=u,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=r,this.targetTileGrid_=i,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;let v=i.getTileCoordExtent(this.wrappedTileCoord_),x=this.targetTileGrid_.getExtent(),g=this.sourceTileGrid_.getExtent(),w=x?ce(v,x):v;if(qt(w)===0){this.state=y.EMPTY;return}let S=t.getExtent();S&&(g?g=ce(g,S):g=S);let b=i.getResolution(this.wrappedTileCoord_[0]),_=Gn(t,n,w,b);if(!isFinite(_)||_<=0){this.state=y.EMPTY;return}let E=f!==void 0?f:.5;if(this.triangulation_=new Mn(t,n,w,g,_*E,b),this.triangulation_.getTriangles().length===0){this.state=y.EMPTY;return}this.sourceZ_=r.getZForResolution(_);let U=this.triangulation_.calculateSourceExtent();if(g&&(t.canWrapX()?(U[1]=Kt(U[1],g[1],g[3]),U[3]=Kt(U[3],g[1],g[3])):U=ce(U,g)),!qt(U))this.state=y.EMPTY;else{let K=r.getTileRangeForExtentAndZ(U,this.sourceZ_);for(let A=K.minX;A<=K.maxX;A++)for(let X=K.minY;X<=K.maxY;X++){let B=a(this.sourceZ_,A,X,u);B&&this.sourceTiles_.push(B)}this.sourceTiles_.length===0&&(this.state=y.EMPTY)}}getImage(){return this.canvas_}reproject_(){let t=[];if(this.sourceTiles_.forEach(function(r,n,i){r&&r.getState()==y.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(r.tileCoord),image:r.getImage()})}.bind(this)),this.sourceTiles_.length=0,t.length===0)this.state=y.ERROR;else{let r=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(r),i=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],o=this.targetTileGrid_.getResolution(r),u=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=jn(i,s,this.pixelRatio_,u,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=y.LOADED}this.changed()}load(){if(this.state==y.IDLE){this.state=y.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(r,n,i){let s=r.getState();if(s==y.IDLE||s==y.LOADING){t++;let o=wt(r,Y.CHANGE,function(u){let l=r.getState();(l==y.LOADED||l==y.ERROR||l==y.EMPTY)&&(et(o),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(o)}}.bind(this)),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(r,n,i){r.getState()==y.IDLE&&r.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(et),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Sn(this.canvas_.getContext("2d")),or.push(this.canvas_),this.canvas_=null),super.release()}},Xn=ar;var ve=class{constructor(t,r,n,i){this.minX=t,this.maxX=r,this.minY=n,this.maxY=i}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,r){return this.minX<=t&&t<=this.maxX&&this.minY<=r&&r<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}};function ht(e,t,r,n,i){return i!==void 0?(i.minX=e,i.maxX=t,i.minY=r,i.maxY=n,i):new ve(e,t,r,n)}var Dn=ve;var ur=class{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let r=this.oldest_;for(;r;)t(r.value_,r.key_,this),r=r.newer}get(t,r){let n=this.entries_[t];return G(n!==void 0,15),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(t){let r=this.entries_[t];return G(r!==void 0,15),r===this.newest_?(this.newest_=r.older,this.newest_&&(this.newest_.newer=null)):r===this.oldest_?(this.oldest_=r.newer,this.oldest_&&(this.oldest_.older=null)):(r.newer.older=r.older,r.older.newer=r.newer),delete this.entries_[t],--this.count_,r.value_}getCount(){return this.count_}getKeys(){let t=new Array(this.count_),r=0,n;for(n=this.newest_;n;n=n.older)t[r++]=n.key_;return t}getValues(){let t=new Array(this.count_),r=0,n;for(n=this.newest_;n;n=n.older)t[r++]=n.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){if(!!this.containsKey(t))return this.entries_[t].value_}pop(){let t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,r){this.get(t),this.entries_[t].value_=r}set(t,r){G(!(t in this.entries_),16);let n={key_:t,newer:null,older:this.newest_,value_:r};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_}setSize(t){this.highWaterMark=t}},Nn=ur;function lr(e,t,r,n){return n!==void 0?(n[0]=e,n[1]=t,n[2]=r,n):[e,t,r]}function dt(e,t,r){return e+"/"+t+"/"+r}function xe(e){return dt(e[0],e[1],e[2])}function kn(e){return e.split("/").map(Number)}function qn(e){return(e[1]<<e[0])+e[2]}function Yn(e,t){let r=e[0],n=e[1],i=e[2];if(t.getMinZoom()>r||r>t.getMaxZoom())return!1;let s=t.getFullTileRange(r);return s?s.containsXY(n,i):!0}var cr=class extends Nn{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;let t=this.peekFirstKey(),n=kn(t)[0];this.forEach(function(i){i.tileCoord[0]!==n&&(this.remove(xe(i.tileCoord)),i.release())}.bind(this))}},Ee=cr;var ao=[0,0,0],ot=5,fr=class{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,G(on(this.resolutions_,function(i,s){return s-i},!0),17);let r;if(!t.origins){for(let i=0,s=this.resolutions_.length-1;i<s;++i)if(!r)r=this.resolutions_[i]/this.resolutions_[i+1];else if(this.resolutions_[i]/this.resolutions_[i+1]!==r){r=void 0;break}}this.zoomFactor_=r,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,G(this.origins_.length==this.resolutions_.length,20));let n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=tt(n)),G(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,G(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:256,G(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map(function(i,s){let o=new Dn(Math.min(0,i[0]),Math.max(i[0]-1,-1),Math.min(0,i[1]),Math.max(i[1]-1,-1));if(n){let u=this.getTileRangeForExtentAndZ(n,s);o.minX=Math.max(u.minX,o.minX),o.maxX=Math.min(u.maxX,o.maxX),o.minY=Math.max(u.minY,o.minY),o.maxY=Math.min(u.maxY,o.maxY)}return o},this):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,r,n){let i=this.getTileRangeForExtentAndZ(t,r);for(let s=i.minX,o=i.maxX;s<=o;++s)for(let u=i.minY,l=i.maxY;u<=l;++u)n([r,s,u])}forEachTileCoordParentTileRange(t,r,n,i){let s,o,u,l=null,a=t[0]-1;for(this.zoomFactor_===2?(o=t[1],u=t[2]):l=this.getTileCoordExtent(t,i);a>=this.minZoom;){if(this.zoomFactor_===2?(o=Math.floor(o/2),u=Math.floor(u/2),s=ht(o,o,u,u,n)):s=this.getTileRangeForExtentAndZ(l,a,n),r(a,s))return!0;--a}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,r,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){let s=t[1]*2,o=t[2]*2;return ht(s,s+1,o,o+1,r)}let i=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(i,t[0]+1,r)}return null}getTileRangeForTileCoordAndZ(t,r,n){if(r>this.maxZoom||r<this.minZoom)return null;let i=t[0],s=t[1],o=t[2];if(r===i)return ht(s,o,s,o,n);if(this.zoomFactor_){let l=Math.pow(this.zoomFactor_,r-i),a=Math.floor(s*l),f=Math.floor(o*l);if(r<i)return ht(a,a,f,f,n);let p=Math.floor(l*(s+1))-1,d=Math.floor(l*(o+1))-1;return ht(a,p,f,d,n)}let u=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(u,r,n)}getTileRangeExtent(t,r,n){let i=this.getOrigin(t),s=this.getResolution(t),o=k(this.getTileSize(t),this.tmpSize_),u=i[0]+r.minX*o[0]*s,l=i[0]+(r.maxX+1)*o[0]*s,a=i[1]+r.minY*o[1]*s,f=i[1]+(r.maxY+1)*o[1]*s;return Tt(u,a,l,f,n)}getTileRangeForExtentAndZ(t,r,n){let i=ao;this.getTileCoordForXYAndZ_(t[0],t[3],r,!1,i);let s=i[1],o=i[2];return this.getTileCoordForXYAndZ_(t[2],t[1],r,!0,i),ht(s,i[1],o,i[2],n)}getTileCoordCenter(t){let r=this.getOrigin(t[0]),n=this.getResolution(t[0]),i=k(this.getTileSize(t[0]),this.tmpSize_);return[r[0]+(t[1]+.5)*i[0]*n,r[1]-(t[2]+.5)*i[1]*n]}getTileCoordExtent(t,r){let n=this.getOrigin(t[0]),i=this.getResolution(t[0]),s=k(this.getTileSize(t[0]),this.tmpSize_),o=n[0]+t[1]*s[0]*i,u=n[1]-(t[2]+1)*s[1]*i,l=o+s[0]*i,a=u+s[1]*i;return Tt(o,u,l,a,r)}getTileCoordForCoordAndResolution(t,r,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],r,!1,n)}getTileCoordForXYAndResolution_(t,r,n,i,s){let o=this.getZForResolution(n),u=n/this.getResolution(o),l=this.getOrigin(o),a=k(this.getTileSize(o),this.tmpSize_),f=u*(t-l[0])/n/a[0],p=u*(l[1]-r)/n/a[1];return i?(f=Zt(f,ot)-1,p=Zt(p,ot)-1):(f=Bt(f,ot),p=Bt(p,ot)),lr(o,f,p,s)}getTileCoordForXYAndZ_(t,r,n,i,s){let o=this.getOrigin(n),u=this.getResolution(n),l=k(this.getTileSize(n),this.tmpSize_),a=(t-o[0])/u/l[0],f=(o[1]-r)/u/l[1];return i?(a=Zt(a,ot)-1,f=Zt(f,ot)-1):(a=Bt(a,ot),f=Bt(f,ot)),lr(n,a,f,s)}getTileCoordForCoordAndZ(t,r,n){return this.getTileCoordForXYAndZ_(t[0],t[1],r,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,r){let n=sn(this.resolutions_,t,r||0);return Kt(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,r){return wn(r,0,r.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){let r=this.resolutions_.length,n=new Array(r);for(let i=this.minZoom;i<r;++i)n[i]=this.getTileRangeForExtentAndZ(t,i);this.fullTileRanges_=n}},Te=fr;var be={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};function we(e){let t=e.getDefaultTileGrid();return t||(t=co(e),e.setDefaultTileGrid(t)),t}function Wn(e,t,r){let n=t[0],i=e.getTileCoordCenter(t),s=zn(r);if(oe(s,i))return t;{let o=j(s),u=Math.ceil((s[0]-i[0])/o);return i[0]+=o*u,e.getTileCoordForCoordAndZ(i,n)}}function uo(e,t,r,n){n=n!==void 0?n:"top-left";let i=lo(e,t,r);return new Te({extent:e,origin:tn(e,n),resolutions:i,tileSize:r})}function lo(e,t,r,n){t=t!==void 0?t:42,r=k(r!==void 0?r:256);let i=bt(e),s=j(e);n=n>0?n:Math.max(s/r[0],i/r[1]);let o=t+1,u=new Array(o);for(let l=0;l<o;++l)u[l]=n/Math.pow(2,l);return u}function co(e,t,r,n){let i=zn(e);return uo(i,t,r,n)}function zn(e){e=z(e);let t=e.getExtent();if(!t){let r=180*ft.degrees/e.getMetersPerUnit();t=Tt(-r,-r,r,r)}return t}var hr=class extends In{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=t.opaque!==void 0?t.opaque:!1,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;let r=[256,256];this.tileGrid&&k(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),r),this.tileCache=new Ee(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,r){let n=this.getTileCacheForProjection(t);n&&n.expireCache(r)}forEachLoadedTile(t,r,n,i){let s=this.getTileCacheForProjection(t);if(!s)return!1;let o=!0,u,l,a;for(let f=n.minX;f<=n.maxX;++f)for(let p=n.minY;p<=n.maxY;++p)l=dt(r,f,p),a=!1,s.containsKey(l)&&(u=s.get(l),a=u.getState()===y.LOADED,a&&(a=i(u)!==!1)),a||(o=!1);return o}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(){return this.tileGrid?this.tileGrid.getResolutions():null}getTile(t,r,n,i,s){return Rt()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:we(t)}getTileCacheForProjection(t){let r=this.getProjection();return G(r===null||st(r,t),68),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,r,n){let i=this.getTileGridForProjection(n),s=this.getTilePixelRatio(r),o=k(i.getTileSize(t),this.tmpSize);return s==1?o:Cn(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(t,r){r=r!==void 0?r:this.getProjection();let n=this.getTileGridForProjection(r);return this.getWrapX()&&r.isGlobal()&&(t=Wn(n,t,r)),Yn(t,n)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,r){let n=this.getTileCacheForProjection(r);t>n.highWaterMark&&(n.highWaterMark=t)}useTile(t,r,n,i){}},Ce=class extends J{constructor(t,r){super(t),this.tile=r}},Kn=hr;function fo(e,t){let r=/\{z\}/g,n=/\{x\}/g,i=/\{y\}/g,s=/\{-y\}/g;return function(o,u,l){if(o)return e.replace(r,o[0].toString()).replace(n,o[1].toString()).replace(i,o[2].toString()).replace(s,function(){let a=o[0],f=t.getFullTileRange(a);return G(f,55),(f.getHeight()-o[2]-1).toString()})}}function Bn(e,t){let r=e.length,n=new Array(r);for(let i=0;i<r;++i)n[i]=fo(e[i],t);return ho(n)}function ho(e){return e.length===1?e[0]:function(t,r,n){if(t){let i=qn(t),s=Ft(i,e.length);return e[s](t,r,n)}else return}}function Zn(e){let t=[],r=/\{([a-z])-([a-z])\}/.exec(e);if(r){let n=r[1].charCodeAt(0),i=r[2].charCodeAt(0),s;for(s=n;s<=i;++s)t.push(e.replace(r[0],String.fromCharCode(s)));return t}if(r=/\{(\d+)-(\d+)\}/.exec(e),r){let n=parseInt(r[2],10);for(let i=parseInt(r[1],10);i<=n;i++)t.push(e.replace(r[0],i.toString()));return t}return t.push(e),t}var $t=class extends Kn{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===$t.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){let r=t.target,n=rt(r),i=r.getState(),s;i==y.LOADING?(this.tileLoadingKeys_[n]=!0,s=be.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=i==y.ERROR?be.TILELOADERROR:i==y.LOADED?be.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new Ce(s,r))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,r){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof r<"u"?this.setKey(r):this.changed()}setUrl(t){let r=Zn(t);this.urls=r,this.setUrls(r)}setUrls(t){this.urls=t;let r=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Bn(t,this.tileGrid),r):this.setKey(r)}tileUrlFunction(t,r,n){}useTile(t,r,n){let i=dt(t,r,n);this.tileCache.containsKey(i)&&this.tileCache.get(i)}},Vn=$t;var dr=class extends Vn{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:po,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:On,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(let t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,r){let n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?r:{});for(let i in this.tileCacheForProjection){let s=this.tileCacheForProjection[i];s.expireCache(s==n?r:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!st(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return this.getProjection()&&t&&!st(this.getProjection(),t)?!1:super.getOpaque(t)}getTileGridForProjection(t){let r=this.getProjection();if(this.tileGrid&&(!r||st(r,t)))return this.tileGrid;{let n=rt(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=we(t)),this.tileGridForProjection[n]}}getTileCacheForProjection(t){let r=this.getProjection();if(!r||st(r,t))return this.tileCache;{let n=rt(t);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new Ee(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]}}createTile_(t,r,n,i,s,o){let u=[t,r,n],l=this.getTileCoordForTileUrlFunction(u,s),a=l?this.tileUrlFunction(l,i,s):void 0,f=new this.tileClass(u,a!==void 0?y.IDLE:y.EMPTY,a!==void 0?a:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return f.key=o,f.addEventListener(Y.CHANGE,this.handleTileChange.bind(this)),f}getTile(t,r,n,i,s){let o=this.getProjection();if(!o||!s||st(o,s))return this.getTileInternal(t,r,n,i,o||s);{let u=this.getTileCacheForProjection(s),l=[t,r,n],a,f=xe(l);u.containsKey(f)&&(a=u.get(f));let p=this.getKey();if(a&&a.key==p)return a;{let d=this.getTileGridForProjection(o),v=this.getTileGridForProjection(s),x=this.getTileCoordForTileUrlFunction(l,s),g=new Xn(o,d,s,v,l,x,this.getTilePixelRatio(i),this.getGutter(),function(w,S,b,_){return this.getTileInternal(w,S,b,_,o)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return g.key=p,a?(g.interimTile=a,g.refreshInterimChain(),u.replace(f,g)):u.set(f,g),g}}}getTileInternal(t,r,n,i,s){let o=null,u=dt(t,r,n),l=this.getKey();if(!this.tileCache.containsKey(u))o=this.createTile_(t,r,n,i,s,l),this.tileCache.set(u,o);else if(o=this.tileCache.get(u),o.key!=l){let a=o;o=this.createTile_(t,r,n,i,s,l),a.getState()==y.IDLE?o.interimTile=a.interimTile:o.interimTile=a,o.refreshInterimChain(),this.tileCache.replace(u,o)}return o}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(let r in this.tileCacheForProjection)this.tileCacheForProjection[r].clear();this.changed()}}setTileGridForProjection(t,r){let n=z(t);if(n){let i=rt(n);i in this.tileGridForProjection||(this.tileGridForProjection[i]=r)}}clear(){super.clear();for(let t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}};function po(e,t){e.getImage().src=t}var pr=dr;function mo(e){let t=j(e)/256,r=new Array(22);for(let n=0,i=r.length;n<i;++n)r[n]=t/2**n;return r}var go={m:1,degree:Math.PI*2*6378137/360,degrees:Math.PI*2*6378137/360,km:.001,in:1/.025399999918,ft:.3048};function _o(e){return go[e]}function yo(e,t,r){let n=39.37007874015748,i=_o(r);return 1/(e*t*n*i)}function Hn(e,t,r=256){return new Te({resolutions:mo(e),tileSize:r,origin:t??le(e)})}var Se=class extends J{value;constructor(t){super(t.type),this.value=t.value}},mr=class extends pr{tileProxy;options;tileSetsIndex=-1;tempIndex=-1;origin;requestParams;tileSets;constructor(t){t=t||{},t.attributions=t.attributions||"Map Data <span>\xA9 <a href='http://support.supermap.com.cn/product/iServer.aspx' target='_blank'>SuperMap iServer</a></span> with <span>\xA9 <a href='https://iclient.supermap.io' target='_blank'>SuperMap iClient</a></span>",t.format=t?.format??"png",super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,opaque:t.opaque,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:t.state,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX!==void 0?t.wrapX:!1}),this.tileProxy=t.tileProxy,this.options=t,this.options.dpi=this.options?.dpi??96,this.options.cacheEnabled=this.options.cacheEnabled!==!1,this.requestParams=this.getAllRequestParams(),this.tileGrid=this.options?.tileGrid??this.setupTileGrid();let r=this.tileGrid.getOrigin(0);this.origin=[r[0],r[1]],this.requestParams.origin=JSON.stringify({x:r[0],y:r[1]}),this.tileUrlFunction=this.tileUrlFunctionSM}get param(){return new URLSearchParams(this.requestParams).toString()}get mapUrl(){return`${this.options.url}/tileImage.${this.options.format}?${this.param}`}setupTileGrid(){if(this.options.extent)return Hn(this.options.extent);if(this.projection==null)throw new Error("missing projection");return Hn(this.projection.getExtent())}getAllRequestParams(){let t={};return t.redirect=this.options?.redirect??!1,t.transparent=this.options?.transparent??!0,t.cacheEnabled=this.options.cacheEnabled,t._cache=t.cacheEnabled,this.origin&&(t.origin=JSON.stringify({x:this.origin[0],y:this.origin[1]})),this.options.prjCoordSys&&(t.prjCoordSys=JSON.stringify(this.options.prjCoordSys)),this.options.layersID&&(t.layersID=this.options.layersID.toString()),this.options.overlapDisplayed?t.overlapDisplayed=!0:(t.overlapDisplayed=!1,this.options.overlapDisplayedOptions&&(t.overlapDisplayedOptions=JSON.stringify(this.options.overlapDisplayedOptions))),t.cacheEnabled&&this.options.tileversion&&(t.tileversion=this.options.tileversion.toString()),t}tileUrlFunctionSM(t,r,n){let i=t[0],s=t[1],o=t[2],u=this.tileGrid.getResolution(i),l=n.getUnits()||"degree";if(this.options.dpi==null)throw new Error("undefined DPI");let a=yo(u,this.options.dpi,l),f=k(this.tileGrid.getTileSize(i)),p=this.mapUrl+encodeURI(`&x=${s}&y=${o}&width=${f[0]}&height=${f[1]}&scale=${a}`);return this.options.cacheEnabled||(p+=`&_t=${new Date().getTime()}`),p}setTileSetsInfo(t){Array.isArray(t)&&(this.tileSets=t[0]),this.tileSets=t,this.tileSets&&(this.dispatchEvent(new Se({type:"tileversionschanged",value:{tileVersion:this.tileSets.tileVersions}})),this.changeTilesVersion())}lastTilesVersion(){this.tempIndex=this.tileSetsIndex-1,this.changeTilesVersion()}nextTilesVersion(){this.tempIndex=this.tileSetsIndex+1,this.changeTilesVersion()}changeTilesVersion(){if(this.tileSets==null||this.tempIndex===this.tileSetsIndex||this.tempIndex<0)return;let t=this.tileSets.tileVersions;if(t&&this.tempIndex<t.length&&this.tempIndex>=0){let r=t[this.tempIndex].name;this.mergeTileVersionParam(r)&&(this.tileSetsIndex=this.tempIndex,this.dispatchEvent(new Se({type:"tileversionschanged",value:{tileVersion:t[this.tempIndex]}})))}}updateCurrentTileSetsIndex(t){this.tempIndex=t}mergeTileVersionParam(t){return t?(this.requestParams.tileversion=t,this.requestParams=this.getAllRequestParams(),this.refresh(),!0):!1}};})();
/*! MIT License © Sindre Sorhus */
//# sourceMappingURL=index.bundle.js.map
